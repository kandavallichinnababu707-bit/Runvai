<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Runvai Builder — PDF Export</title>
<script src="https://cdn.tailwindcss.com"></script>
<!-- html2pdf bundle -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<style>body{font-family:Inter, Poppins, system-ui;background:linear-gradient(180deg,#03040a,#071026);color:#e6eef8;padding:24px} .editor{min-height:420px}</style>
</head><body>
<header class="max-w-6xl mx-auto flex items-center justify-between mb-6"><div class="flex items-center gap-3"><img src="assets/logo.svg" style="width:44px"/><h1 class="text-xl font-bold">Runvai Builder — PDF Export</h1></div><a href="preview.html" class="px-3 py-2 rounded bg-indigo-600">Templates</a></header>

<main class="max-w-6xl mx-auto bg-slate-900 p-6 rounded-lg">
  <div class="grid lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2">
      <h2 class="font-bold text-lg">Live Editor</h2>
      <div class="mt-3">
        <label class="text-sm text-slate-300">Select source template</label>
        <select id="templateSelect" class="mt-2 p-2 bg-black rounded w-full">
          <option value="templates/a4-example.html">A4 Example (default)</option>
        </select>
      </div>
      <div class="mt-3">
        <iframe id="previewFrame" src="templates/a4-example.html" style="width:100%;height:520px;border:0;background:white"></iframe>
      </div>

      <div class="mt-4 flex gap-2">
        <label class="text-sm text-slate-300 flex items-center gap-2">PDF size:
          <select id="pdfSize" class="ml-2 p-2 rounded bg-black">
            <option value="a4">A4 (210×297 mm)</option>
            <option value="letter">US Letter (8.5×11 in)</option>
            <option value="compact">Compact (2-column tight)</option>
          </select>
        </label>

        <button id="downloadPdf" class="px-3 py-2 rounded bg-emerald-600">Download as PDF</button>
        <button id="downloadHtml" class="px-3 py-2 rounded bg-indigo-600">Download HTML</button>
      </div>
    </div>

    <aside class="p-4 rounded bg-slate-800">
      <h3 class="font-semibold">Preview Controls</h3>
      <p class="text-sm text-slate-400 mt-2">Resize preview and then export. PDF export preserves A4/Letter dimensions and scales content to fit.</p>
    </aside>
  </div>
</main>

<script>
const previewFrame = document.getElementById('previewFrame');
document.getElementById('templateSelect').addEventListener('change', (e) => {
  previewFrame.src = e.target.value;
});

function getPdfOptions(size){
  if(size === 'a4') return {margin:10, filename:'Runvai_Resume.pdf', image:{type:'jpeg', quality:0.98}, html2canvas:{scale:2, useCORS:true}, jsPDF:{unit:'mm', format:'a4', orientation:'portrait'}};
  if(size === 'letter') return {margin:10, filename:'Runvai_Resume_Letter.pdf', image:{type:'jpeg', quality:0.98}, html2canvas:{scale:2, useCORS:true}, jsPDF:{unit:'in', format:'letter', orientation:'portrait'}};
  if(size === 'compact') return {margin:5, filename:'Runvai_Resume_Compact.pdf', image:{type:'jpeg', quality:0.98}, html2canvas:{scale:2, useCORS:true}, jsPDF:{unit:'pt', format:[560,792], orientation:'portrait'}};
  return {};
}

document.getElementById('downloadPdf').addEventListener('click', async ()=>{
  const size = document.getElementById('pdfSize').value;
  const opts = getPdfOptions(size);
  // get the iframe document body node
  const iframe = document.getElementById('previewFrame');
  const doc = iframe.contentWindow.document;
  // clone node to avoid CORS issues altering original
  const node = doc.getElementById('resume-root') || doc.body;
  // create a wrapper element in current document
  const wrapper = document.createElement('div');
  wrapper.style.background = '#fff';
  wrapper.style.padding = '0';
  wrapper.appendChild(node.cloneNode(true));
  // call html2pdf on wrapper
  html2pdf().set(opts).from(wrapper).save().then(() => {
    console.log('PDF saved');
  }).catch(err => { console.error(err); alert('PDF export failed: '+err.message); });
});

document.getElementById('downloadHtml').addEventListener('click', ()=>{
  const iframe = document.getElementById('previewFrame');
  const doc = iframe.contentWindow.document;
  const html = '<!doctype html>' + doc.documentElement.innerHTML;
  const blob = new Blob([html], {type:'text/html'});
  const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='resume.html'; a.click(); URL.revokeObjectURL(url);
});
</script>

</body></html>